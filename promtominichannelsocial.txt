You are AntiGravity, an expert AI system architect and Laravel SaaS engineer.

SYSTEM: Resevit – Multi-Tenant Restaurant SaaS Platform
TECH: Laravel 12, Filament 4, Livewire 3, Stancl Tenancy v3 (Multi-DB)

---------------------------------------------------------
FEATURE NAME
---------------------------------------------------------
Tenant Social Media Messaging Integration

---------------------------------------------------------
FEATURE CONTEXT
---------------------------------------------------------
PANEL: Business Owner Panel (/dashboard)
DATABASE CONTEXT: TENANT DATABASE ONLY
ACCESS ROLES:
- business_owner
- manager

This feature is NOT accessible to Super Admins, Investors, or Customers.

---------------------------------------------------------
FEATURE OBJECTIVE
---------------------------------------------------------
Allow Business Owners to connect their restaurant’s social media messaging
channels (WhatsApp, Facebook Messenger, Instagram DM) so that:

1. Incoming messages from connected social platforms appear INSIDE
   the internal Messaging System (Feature 7).
2. Business Owners and authorized staff can REPLY to those messages
   directly from the platform.
3. All messages remain STRICTLY tenant-isolated.
4. AI automation (if enabled) can assist with responses using tenant-only data.

---------------------------------------------------------
SUPPORTED CHANNELS (PHASE 1)
---------------------------------------------------------
- WhatsApp Business API
- Facebook Messenger
- Instagram Direct Messages

---------------------------------------------------------
FEATURE SCOPE
---------------------------------------------------------
This feature MUST include:

1) SOCIAL ACCOUNT CONNECTION (TENANT SETTINGS)
   - Tenant-level settings page in Business Owner Panel
   - Secure fields for:
        • WhatsApp Business API credentials
        • Facebook Page ID + Access Token
        • Instagram Business Account ID + Token
   - Encrypted storage of API keys (tenant DB)
   - Ability to enable / disable each channel independently

2) WEBHOOK INGESTION
   - Webhook endpoints for each platform
   - Validate webhook signatures
   - Resolve tenant context using:
        • platform account ID
        • mapped tenant record
   - Reject any message that cannot be safely mapped to ONE tenant

3) MESSAGE UNIFICATION
   - Normalize all inbound messages into a single `chats` system
   - Required metadata per message:
        • tenant_id
        • channel (whatsapp | facebook | instagram)
        • external_message_id
        • sender_name
        • sender_handle
        • raw_payload (JSON)
   - Tag each message with its platform source

4) INTERNAL CHAT UI INTEGRATION
   - Messages must appear in Feature 7 (Messaging System)
   - Visual channel indicators (icon + label)
   - Ability for staff to:
        • view message history
        • reply in real time
        • see delivery status (sent / failed)

5) OUTBOUND MESSAGE SENDING
   - Replies sent from platform chat MUST:
        • route back to the correct social API
        • preserve conversation threading
        • handle API rate limits & errors gracefully

6) AI ASSISTED RESPONSES (OPTIONAL)
   - If AI is enabled:
        • Suggest replies using tenant-only data
        • Respect brand tone
        • Never auto-send without human confirmation
   - AI must NEVER:
        • access other tenants
        • expose system prompts
        • claim external data access

---------------------------------------------------------
SECURITY & TENANCY RULES (NON-NEGOTIABLE)
---------------------------------------------------------
- ALL data stored in TENANT DATABASE
- NO cross-tenant message access
- NO global database usage
- API keys encrypted at rest
- Webhooks must resolve tenant BEFORE processing payload

---------------------------------------------------------
DATA MODELS (REQUIRED)
---------------------------------------------------------
Tenant DB must include:

- social_accounts
    • id
    • tenant_id
    • platform
    • external_account_id
    • credentials (encrypted)
    • is_active

- chats
- chat_messages
    • channel
    • external_message_id
    • direction (inbound | outbound)

---------------------------------------------------------
IMPLEMENTATION REQUIREMENTS
---------------------------------------------------------
- Use Service layer for each platform:
    • WhatsAppService
    • FacebookMessengerService
    • InstagramDMService

- Messaging orchestration via:
    • SocialMessageRouterService

- Filament Resources:
    • SocialAccountResource (Tenant Panel)
    • Messaging UI extension

---------------------------------------------------------
FAILURE HANDLING
---------------------------------------------------------
- If API token expires → notify Business Owner
- If webhook fails → log + retry
- If tenant mapping fails → discard safely

---------------------------------------------------------
OUTPUT REQUIREMENTS
---------------------------------------------------------
When implementing this feature, you MUST output:

1. Feature Summary
2. Tenant-only folder structure
3. Migrations
4. Models
5. Filament Resources & Pages
6. Webhook routes
7. Services
8. Security notes
9. Testing instructions

---------------------------------------------------------
IMPORTANT
---------------------------------------------------------
This feature MUST behave like a native omnichannel inbox
for restaurant owners.

This is NOT a global feature.
This is NOT a Super Admin feature.

Tenant isolation is ABSOLUTE.
